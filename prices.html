<div
  id="rec706492311908"
  class="r"
  style="padding-top: 90px; padding-bottom: 120px"
>
  <div class="t431">
    <div class="t-container"></div>
  </div>

  <style>
    #rec706492311908 .t431 .t431__th {
      border-width: 0px 0px 1px 0px;
      border-color: #000000;
    }

    #rec706492311908 .t431 .t431__tbody tr:nth-child(1) td {
      border-top: 0 !important;
    }

    #rec706492311908 .t431 .t431__td {
      border-width: 1px 0px;
      vertical-align: ;
      border-color: #d9d9d9;
      color: #4d4c4c;
    }

    #rec706492311908 .t431 .t431__oddrow {
      background: #ffffff;
    }

    #rec706492311908 .t431 .t431__evenrow {
      background: #eeeeee;
    }

    #rec706492311908 .t431 .t431__btnwrapper a {
      color: #ffffff;
      border: 0px solid #000000;
      background-color: #000000;
      border-radius: 21px;
      -moz-border-radius: 21px;
      -webkit-border-radius: 21px;
    }

    #rec706492311908 .t431__table th {
      border: 1px solid #d9d9d9;
    }

    #rec706492311908 .t431__table input::-webkit-outer-spin-button,
    #rec706492311908 .t431__table input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox */
    #rec706492311908 .t431__table input[type="number"] {
      appearance: textfield;
    }
  </style>

  <script>
    // t_onReady(function () {
    // t_onFuncLoad("t431_init", function () {
    // t431_init(706492311908);
    // });
    // });

    const results = {};

    const SIZES = {
      MODEL_WIDTH: "20%",
      DESCRIPTION_WIDTH: "30%",
      SIZE_WIDTH: "15%",
      AMOUNT_WIDTH: "15%",
      PRISE_WIDTH: "20%",
    };

    const KEYS = {
      0: "MODEL_WIDTH",
      1: "DESCRIPTION_WIDTH",
      2: "SIZE_WIDTH",
      3: "AMOUNT_WIDTH",
      4: "PRISE_WIDTH",
    };

    const STEP = 0.5;

    const data = mapIds([
      {
        title: "Извещатели малой дальности",
        header: ["Модель", "Описание", "Размер", "Количество", "Цена"],
        rows: [
          {
            model: "ДИА-2/16",
            description:
              "Датчик для систем автоматики, безынерционный, дальность связи до 3 м, Дальность регулируемая. Высота датчика от 0,5м ло 3 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 30х40мм.",
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "ДИА-10/8",
            description:
              "Датчик охранный, безынерционный, дальность связи до 10 м, Дальность регулируемая. Использование в закрытых помещениях. Без защиты от солнечных помех. Высота датчика от 0,5м ло 4 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 30х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "ДИА-10/16",
            description:
              "Датчик охранный, безынерционный, дальность связи до 10 м, Дальность регулируемая. Использование в закрытых помещениях. Без защиты от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 30х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "ДИАС-10/16",
            description:
              "Датчик охранный, безынерционный, дальность связи до 10 м, Дальность регулируемая. Уличное исполнение. Температура от -30 до +55°С.100% защита от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 30х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
        ],
      },
      {
        title: "Извещатели средней дальности",
        rows: [
          {
            model: "ДИА-60/16",
            description:
              "Датчик охранный, безынерционный, дальность связи до 60 м, Дальность регулируемая. Использование в закрытых помещениях. Без защиты от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 60х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "ДИАС-60/16",
            description:
              "Датчик охранный, безынерционный, дальность связи до 60 м, Дальность регулируемая. Уличное исполнение. Температура от -30 до +55°С.100% Защита от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 60х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
        ],
      },
      {
        title: "Извещатели большой дальности",
        rows: [
          {
            model: "ДИАС-100/16",
            description:
              "Датчик охранный, безынерционный, дальность связи до 100 м, Дальность регулируемая. Использование в закрытых помещениях. Без защиты от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 60х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "ДИАС-150/16С",
            description:
              "Датчик охранный, безынерционный, дальность связи до 150 м, Дальность регулируемая. Уличное исполнение. Температура от -30 до +55°С.100% Защита от солнечных помех. Высота датчика от 0,5м ло 6 м. Шаг 0.5м. Расстояние между лучами 16см. Корпус 60х40мм.",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
        ],
      },
      {
        title: "Запасные части, ремкомплекты",
        rows: [
          {
            model: "МП ДИА-2/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИА-2/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИА-10/8",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИА-10/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИАС-10/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИА-60/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИАС-100/16",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "МП ДИАС-150/16С",
            description: "Плата излучателей и приемников",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "PINP 3.8",
            description: "Плата управления",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
        ],
      },
      {
        title: "Модули питания",
        rows: [
          {
            model: "Преобразователь 24/12",
            description: "― 24В(АС) на 12 В(DC) ― 3А",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
          {
            model: "Преобразователь 48/12",
            description: "― 48В(АС) на 12 В(DC) ― 3А",
            // МОК
            prise: {
              0.5: 18000,
              1: 34000,
              1.5: 50000,
              2: 66000,
              2.5: 82000,
              3: 98000,
            },
          },
        ],
      },
    ]);

    function getDispatch(data) {
      return ({id, ...payload}) => {
        results[id] = {id, ...results[id], ...payload};
        results[id].total =
          results[id].amount * (results[id].prise[results[id].size] ?? 0);
        console.log("results: ", results);
        rerender(results);
      };
    }

    const createTable = getCreateTable(data);
    const dispatch = getDispatch(data);

    const container = document.querySelector("#rec706492311908 .t431");
    if (container) {
      const tableElement = createTable(data);
      container.prepend(tableElement);
    }

    function getCreateTable(data) {
      const createTitle = getCreateTitle(data);
      const createHeader = getCreateHeader(data);
      const createBody = getCreateBody(data);

      return () => {
        const tableElement = document.createElement("table");
        tableElement.classList.add("t431__table");
        tableElement.setAttribute("width", "100%");

        data.forEach((row) => {
          // Создание заголовка. Пример: "Извещатели малой дальности"
          if (row.title) {
            const thead = createTitle(row);
            tableElement.appendChild(thead);
          }

          // Создание шапки таблицы. Пример: "Модель", "Описание", "Размер", "Количество", "Цена"
          if (row.header && row.header.length) {
            const thead = createHeader(row);
            tableElement.appendChild(thead);
          }

          // Создание строк таблицы
          if (row.rows && row.rows.length) {
            const tbody = createBody(row);
            tableElement.appendChild(tbody);
          }
        });

        return tableElement;
      };
    }

    function getCreateTitle(data) {
      return (row) => {
        const thead = document.createElement("thead");
        thead.classList.add("t431__thead");

        const tr = document.createElement("tr");
        const th = document.createElement("th");
        th.setAttribute("colspan", "5");
        th.classList.add("t431__th");
        th.classList.add("t-title");
        th.innerText = row.title;
        tr.appendChild(th);
        thead.appendChild(tr);

        return thead;
      };
    }

    function getCreateHeader(data) {
      return (row) => {
        const thead = document.createElement("thead");
        thead.classList.add("t431__thead");

        const tr = document.createElement("tr");
        row.header.forEach((text, index) => {
          const th = document.createElement("th");
          th.setAttribute("width", SIZES[KEYS[index]]);
          th.classList.add("t431__th");
          th.classList.add("t-title");
          th.innerText = text;
          tr.appendChild(th);
        });

        thead.appendChild(tr);
        return thead;
      };
    }

    function getCreateBody(data) {
      const createSizeSelect = getCreateSizeSelect(data);
      const createAmountInput = getCreateAmountInput(data);

      return (data) => {
        const tbody = document.createElement("tbody");
        tbody.classList.add("t431__tbody");

        data.rows.forEach((currentRow) => {
          dispatch({
            id: currentRow.id,
            prise: currentRow.prise,
            size: null,
            amount: null,
          });

          const tr = document.createElement("tr");
          tr.setAttribute("id", currentRow.id);

          // Модель
          const tdModel = document.createElement("td");
          tdModel.classList.add("model");
          tdModel.classList.add("t431__td");
          tdModel.classList.add("t-text");
          tdModel.innerHTML = currentRow.model;

          // Описание
          const tdDescription = document.createElement("td");
          tdDescription.classList.add("description");
          tdDescription.classList.add("t431__td");
          tdDescription.classList.add("t-text");
          tdDescription.innerHTML = currentRow.description;

          // Размер
          const tdSize = document.createElement("td");
          tdSize.classList.add("size");
          tdSize.classList.add("t431__td");
          tdSize.classList.add("t-text");
          const select = createSizeSelect(currentRow);
          tdSize.appendChild(select);

          // Количество
          const tdAmount = document.createElement("td");
          tdAmount.classList.add("amount");
          tdAmount.classList.add("t431__td");
          tdAmount.classList.add("t-text");
          const amountInput = createAmountInput(currentRow);
          tdAmount.appendChild(amountInput);

          // Цена
          const tdPrise = document.createElement("td");
          tdPrise.classList.add("prise");
          tdPrise.classList.add("t431__td");
          tdPrise.classList.add("t-text");
          tdPrise.innerHTML =
            results[currentRow.id].total > 0
              ? results[currentRow.id].total
              : "";

          tr.appendChild(tdModel);
          tr.appendChild(tdDescription);
          tr.appendChild(tdSize);
          tr.appendChild(tdAmount);
          tr.appendChild(tdPrise);

          tbody.appendChild(tr);
        });

        return tbody;
      };
    }

    function getCreateSizeSelect(data) {
      return (row) => {
        const select = document.createElement("select");
        select.setAttribute("data-id", row.id);
        addEventListener(select, "change", "size");

        const sizes = Object.keys(row.prise ?? {});

        if (!sizes.length) {
          return select;
        }

        const option = document.createElement("option");
        option.setAttribute("selected", "true");
        option.value = "";
        option.text = "";
        select.appendChild(option);

        sizes
          .map((size) => Number(size))
          .sort((a, b) => a - b)
          .forEach((size) => {
            const option = document.createElement("option");
            option.value = String(size);
            option.text = size;
            select.appendChild(option);
          });

        return select;
      };
    }

    function getCreateAmountInput(data) {
      return (row) => {
        const input = document.createElement("input");
        input.setAttribute("data-id", row.id);
        addEventListener(input, "change", "amount");
        input.type = "number";
        input.min = 0;
        return input;
      };
    }

    function rerender(results) {
      const keys = Object.keys(results);
      keys.forEach((key) => {
        const priseEl = document.querySelector(`#${key} .prise`);
        if (priseEl && results[key].total > 0) {
          priseEl.innerHTML = results[key].total ?? "";
        }
      });
    }

    function mapIds(table) {
      return table.map((row) => ({
        ...row,
        rows: row.rows.map((currentRow) => ({
          ...currentRow,
          id: currentRow.model.replaceAll("/", "-").replaceAll(/\s+|\./g, ""),
        })),
      }));
    }

    function addEventListener(element, eventType, field) {
      element.addEventListener(eventType, (event) => {
        const value = event.target.value;
        const id = event.target.dataset.id;
        dispatch({id, [field]: Number(value)});
      });
    }
  </script>
</div>
